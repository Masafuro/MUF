# MUF セキュリティガイドライン：設計思想と実装原則

## 1. ゼロトラスト・モデルに基づく設計の基本方針
MUF（Memory Unit Framework）は、ユニット間の通信基盤であるmuf-network（Redis）を「信頼の境界」の内部とは見なさない、ゼロトラスト・モデルを前提としています。これは、各ユニットが相互に接続されていても、ネットワークを流れるデータは常に未検証の入力として扱う必要があることを意味します。開発者は、各ユニットが自律的なセキュリティ境界として機能するよう、外部からの入力に対して常に検証を行う姿勢で設計を進めてください。

## 2. ユニット固有のシリアライズによるデータ検証
MUF SDKは、muf-networkへのデータ投入・閲覧、およびキー名の管理といった基盤機能を提供しますが、送受信されるデータの具体的な構造やシリアライズ・デシリアライズの方法については、各ユニットの設計に委ねられています。ユニット開発者は、自身のユニットに届くデータが期待される構造であることを保証するために、適切なシリアライズ手法（JSON, MessagePack等）を自ら選択し、ユニット内部に厳格なバリデーションロジックを組み込んでください。これにより、不正なデータや意図しないコマンドの実行を、ロジックの最上流で遮断することが可能になります。

## 3. 機密情報の局所化と絶縁管理
パスワードやAPIキー、秘密鍵といった機密性の高い情報は、その情報を直接的に必要とするユニット内部のデータベース（ScyllaDB等）にのみ保持し、局所化を図ってください。muf-network（Redis）は、あくまで一時的な情報の共有や制御コマンドの伝達のために利用し、生データの機密情報がネットワーク上に露出しないよう設計します。この情報の絶縁により、システムの特定の層が侵害された場合でも、最重要データの保護を継続することが可能になります。

## 4. 最小権限原則に基づくアクセス制御
各ユニットに対しては、その機能を実現するために不可欠な、最小限のRedisアクセス権限のみを付与してください。RedisのACL（Access Control Lists）機能を適用し、特定のキーパターンに対する操作のみを許可することで、万が一ユニットが侵害された際の横移動（Lateral Movement）を物理的に制約できます。デフォルトで全権限を付与するのではなく、必要に応じて権限を定義していくアプローチが望ましいです。

## 5. ステートのライフサイクルと情報の破棄
muf-networkに格納される全てのデータには、適切なTTL（Time To Live）を設定し、有効期限を管理してください。情報の生存期間を必要最小限に留めることで、古いセッション情報や一時的なコマンドが不当に再利用されるリスクを軽減できます。また、不要になったデータは自動的に破棄される仕組みを前提とすることで、システムの健全性と安全性を自動的に維持することが可能となります。

## 6. 運用環境における認証情報の管理
公開リポジトリにおいて、本番環境で使用される認証情報が混入しないよう細心の注意を払ってください。環境変数（.env）の管理については、テンプレートとなるファイル（.env.sample等）のみをリポジトリに含め、実運用におけるパスワードや鍵情報はデプロイ環境ごとに個別に生成・管理する運用を徹底します。これにより、開発の利便性を損なうことなく、機密情報の流出を確実に防ぐことができます。