# MUF: Memory Unit Framework

## プロジェクトの概要と設計思想

MUF（Memory Unit Framework）は、分散システムにおけるユニット間連携を、Redis上の階層化されたキー空間の状態変化として再定義するフレームワークです。本フレームワークは、産業用コントローラの共有メモリ概念をネットワーク空間へ拡張し、各ユニットが特定の階層構造に従ってデータを配置することで、疎結合かつ自律的な連携を実現します。最大の特徴は、RedisのKeyspace Notificationsを利用したリアクティブなイベント駆動モデルと、すべてのデータに設定されるTTL（有効期限）による自動的なメモリ清掃機能にあります。これにより、開発者は複雑な通信制御や残留データの管理を意識することなく、非同期なリクエスト・レスポンス処理を記述できます。

---

## 通信ステータス仕様

MUFプロトコルでは、すべてのデータは以下のいずれかのステータスを持ち、それぞれの役割と有効期限が厳密に定義されています。

| ステータス名 | 役割の定義 | デフォルト有効期限(TTL) |
| :--- | :--- | :--- |
| **REQ** | 特定の処理を依頼するリクエスト。送信側ユニットのディレクトリ配下に生成されます。 | 10秒 |
| **RES** | リクエストに対する成功応答。リクエスト送信側のRESディレクトリに書き戻されます。 | 60秒 |
| **ERR** | 処理中に発生した例外やエラーの通知。RESと同様のパスに書き戻されます。 | 60秒 |
| **KEEP** | システム全体で共有する状態データやパラメータ。長期間の保持が前提となります。 | 3600秒 |

---

## 開発環境の運用手順

システムの基盤を起動し、対話型デバッグを開始するための標準的な手順を以下に示します。

まず、システムの心臓部であるRedisコンテナを起動します。
> docker compose -f redis/docker-compose.yml up -d

次に、人間がシステムに介入するためのターミナルユニットを起動します。
> docker compose -f terminal/docker-compose.yml up -d

ターミナルユニットの対話モードに入り、リクエストの送信や状態の監視を行うには以下のコマンドを実行します。
> docker exec -it muf-terminal python terminal/main.py

また、Redis上のすべての通信トラフィックをリアルタイムで監視したい場合は、以下のコマンドでモニターを起動します。
> docker exec -it muf-terminal redis-cli -h muf-redis monitor

---

## ディレクトリ構成と各コンポーネントの責務

プロジェクトは独立したコンポーネントに分離されており、それぞれが特定の役割を担います。

| ディレクトリ | 構成要素 | 責務の詳細 |
| :--- | :--- | :--- |
| **redis/** | データ基盤 | Keyspace Notificationsを有効にしたRedisサーバーを構築し、全ユニットの共有空間を提供します。 |
| **muf/** | MUF SDK | 接続管理、パス生成、非同期監視、タイムアウト管理など、プロトコルの核となる共通ライブラリです。 |
| **terminal/** | HMIユニット | ユーザーが任意のユニット名やコマンド、データを指定してシステムを操作するための対話型検証環境です。 |

---

## 現在の進捗と開発フロー

現在は、SDKにおける基本的なプロトコルスタックの実装が完了し、ターミナルユニットを用いた対話的な通信テストに成功しています。特定のユニット名でリクエストを発行して待機状態に入り、別のコンソールから対応するレスポンスを書き込むことで、フロントエンドが即座に応答を検知して処理を再開する一連のサイクルが実証されています。これは、Redisのキー生成通知とPythonの非同期処理がSDK内で正しく統合されていることを示しています。

## 今後の展望

基盤と操作環境が整ったため、次なるステップとして、特定のリクエストに対して自動的に処理を行い結果を書き戻すバックエンドユニットの実装へと移行します。このユニットが加わることで、リクエストからレスポンス、そして完了後の自動清掃に至るまでの通信ライフサイクルが完全に自動化されます。さらに、システムが複雑化するにつれて重要となる、状態データの永続化戦略や、より高度なガベージコレクション機能の検討も進めていく予定です。