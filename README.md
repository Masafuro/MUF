# MUF: Memory Unit Framework

## プロジェクトの概要

MUF（Memory Unit Framework）は、分散システムにおけるユニット間の連携を「メッセージの送受信」ではなく「共有メモリの状態同期」として再定義する次世代のフレームワークです。産業用コントローラ（PLC）における共有メモリやレジスタ操作の直感的な概念をネットワーク空間へと拡張し、各ユニットが独立して共通のメモリ空間を読み書きすることで、極めて疎結合で自律的なシステム連携を実現します。Redisを高速なバッファ基盤として活用することで、開発者は複雑なAPIの設計や通信プロトコルの詳細を意識することなく、変数を操作するような手軽さで高度な分散処理を記述できます。

---

## 開発コマンドの利用手順

システムの起動と運用はルートディレクトリから一括して管理できます。まず、システム全体の基盤と常駐ユニットを立ち上げるには

> docker compose up -d

を実行します。これにより、Redis、モニター、およびターミナルの各コンテナが統合的に起動します。

共有メモリ上の状態遷移をリアルタイムで監視したい場合は、別のターミナルウィンドウで

> docker logs -f muf-monitor

を実行してください。これにより、メモリ上のフラグの動きやデータの更新を常に把握することが可能になります。

また、システムに対して能動的に干渉し、データを書き込んだりリクエストを発行したりするには、ターミナルユニットの対話モードを利用します。

> docker exec -it muf-terminal python terminal.py

と入力することで、専用のプロンプトが立ち上がり、任意のパスに対して値を投げ込むことができるようになります。

---

## ディレクトリ構成と各ユニットの役割

本プロジェクトは複数の独立したコンポーネントによって構成されています。各コンポーネントは特定の責務を持ち、共通ネットワークを介して互いに干渉し合います。

| ディレクトリ | 役割の定義 |
| :--- | :--- |
| **redis/** | システムの心臓部となる共有メモリ空間（Redis）を構築します。KEA通知設定により、メモリの更新イベントを全ユニットへ配送する役割を担います。 |
| **muf/** | MUFの機能をプログラムから利用するためのSDKです。ワイルドカードによる広域監視（PSUBSCRIBE）に対応したObserver層と、同期通信の手順を定めたProtocol層を備えています。 |
| **monitor/** | 共有メモリの状態を可視化するデバッグユニットです。ワイルドカード指定（muf/*など）により、特定の階層下で発生するあらゆる状態変化を逃さずダンプします。 |
| **terminal/** | 人間がシステムに介入するためのHMI（Human Machine Interface）ユニットです。対話的な入力により、SDKを介して共有メモリへのリクエスト発行と応答確認を行います。 |

---

## 開発の進捗状況とフロー

現在は、Redisによる共有メモリ基盤の構築から、SDKにおけるワイルドカード監視の実装、そして監視と操作を担う基本ツール群の整備までが完了しています。ルートディレクトリのdocker-compose.ymlによる統合管理により、開発環境のセットアップは極めて迅速に行えるようになっています。

ターミナルユニットから任意のパスに対してデータを送信し、それをモニターユニットが広域監視モードで即座に検知するという、MUFにおける「神経網」の疎通確認は既に成功しています。現在は「問いかけ」に対して「応答」する存在が不在であるためタイムアウトが発生する状態にあり、システムは最初のロジック層の受け入れ準備が整った段階にあります。

---

## 今後の展望

基盤と操作環境が整ったため、次なるステップとして、特定のリクエストに対して自動的に処理を行い結果を書き戻す「ロジックユニット（Echoユニット等）」の実装へと移行します。このユニットが加わることで、リクエストからレスポンス、そして完了後のフラグ清掃に至るまでの一連の通信サイクルが完全にクローズされます。さらに、システムが複雑化するにつれて重要となる、使用済みメモリ領域の動的な管理や、より高度なガベージコレクション機能の検討も進めていく予定です。